; Author: Ruchir Mehta
; Date: 26th Mar 2021
;
; Purpose: Trying up execve-shellcoding-gedit
section .data
    dis db "DISPLAY=:0"
global _start

section .text
_start:

    ;pushing the first null dword
    xor eax, eax
    push eax
    push 0x0000303a
    push 0x3d59414c
    push 0x50534944
    mov ebp, esp

    push eax
    ;Stack: NULL
    ;Pushing the ///bin//bash (12) (number of / does not matter)
    ;push 0x68736162
    ;push 0x2f2f6e69
    ;push 0x622f2f2f

    ;Stack: ///bin//bash | NULL
    push 0x74696465
    push 0x672f2f2f
    push 0x6e69622f
    push 0x7273752f
    
    ;Stack: ///bin//bash | NULL
    mov ebx, esp 
    ;esp is the stack pointer, ebx holds the char *filename

    push eax
    
    push ebp

    ;push dis ;Optional

    ;Stack: "DISPLAY=:0" | NULL | ///bin//bash | NULL
    mov edx, esp
    ;edx holds the char *const envp[]
    
    push eax
    ;Stack: NULL | "DISPLAY=:0" | NULL | ///bin//bash | NULL

    push ebx
    
    ;Stack: $pointer_to_filename | NULL | ///bin//bash | NULL
    mov ecx, esp
    ;ecx holds the char *const argv[]
    
    ;execve syscall number
    mov al, 0xb
    
    ;calling interrupt
    int 0x80
